#!/usr/bin/env bash
# Reset the development environment (removes volumes)
set -e

cd "$(dirname "$0")/../.."

echo "This will remove all containers and volumes (including database data)."
read -p "Are you sure? (y/N) " -n 1 -r
echo

if [[ $REPLY =~ ^[Yy]$ ]]; then
  echo "==> Stopping and removing containers..."
  docker compose down -v

  echo "==> Rebuilding..."
  docker compose build

  echo "==> Starting fresh..."
  docker compose up -d

  echo "==> Waiting for container to be ready..."
  sleep 3

  echo "==> Setting up database..."
  docker compose exec web bin/rails db:prepare

  echo "==> Reset complete!"
else
  echo "Aborted."
fi

